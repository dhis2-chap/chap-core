<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Wrapping GluonTS models" href="../tutorials/wrapping_gluonts.html" /><link rel="prev" title="CHAP-Core docker compose setup" href="docker-compose-doc.html" />

    <!-- Generated with Sphinx 8.1.0 and Furo 2024.08.06 -->
        <title>Running CHAP Core on a server with DHIS2 to be used with the Prediction App - Climate Health 0.0.17 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/_static/" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Climate Health 0.0.17 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Climate Health 0.0.17 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Installation and getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation and getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Releases and future plans</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CHAP Core REST-API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="docker-compose-doc.html">CHAP-Core docker compose setup</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Running CHAP Core on a server with DHIS2 to be used with the Prediction App</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using CHAP as a library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/wrapping_gluonts.html">Wrapping GluonTS models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_docs.html">API documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the Predictions App with CHAP (and integration with DHIS2)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../prediction-app/prediction-app.html">Prediction App for end-users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prediction-app/using-pa-with-cli.html">Use JSON-file from Prediction App with CHAP Core CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/downloaded_json_data.html">Running on JSON data downloaded from the Prediction App</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Integrating external or custom models with CHAP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../external_models/making_external_models_compatible.html">Making existing models compatible with CHAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../external_models/developing_custom_models.html">Developing your own custom model with CHAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../external_models/external_model_specification.html">External model specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../external_models/running_external_models.html">Running models through CHAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../external_models/integrating_external_models_with_dhis2.html">Integrating external models with DHIS2 through CHAP</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer/getting_started.html">Developer getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/code_overview.html">Code overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/testing.html">Testing while developing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/writing_building_documentation.html">Writing and building documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/code_guidelines.html">Code guidelines</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/rest-api/running-chap-on-server.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="running-chap-core-on-a-server-with-dhis2-to-be-used-with-the-prediction-app">
<h1>Running CHAP Core on a server with DHIS2 to be used with the Prediction App<a class="headerlink" href="#running-chap-core-on-a-server-with-dhis2-to-be-used-with-the-prediction-app" title="Link to this heading">¶</a></h1>
<p>Before you set up CHAP Core on a server, we recommend you familiarize yourself with CHAP Core, the Prediction App, and test it out locally.</p>
<p><strong>Requirements:</strong></p>
<ul class="simple">
<li><p>Access to credentials to Google Earth Engine (Google Service Account Email and Private Key) Read more here: <a class="reference external" href="https://docs.dhis2.org/en/manage/reference/google-service-account-configuration.html">https://docs.dhis2.org/en/manage/reference/google-service-account-configuration.html</a></p></li>
<li><p>DHIS2 version <strong>2.41.2+</strong></p></li>
</ul>
<p>In the documentation for <a class="reference external" href="https://dhis2-chap.github.io/chap-core/prediction-app/prediction-app.html">Use Prediction App to transfer data directly to CHAP Core’s REST-API</a>, we were running CHAP Core locally and exposed the CHAP Core on http://localhost:8000. In that example, we configured the Prediction App to connect to CHAP Core over http://localhost:8000 by editing the CHAP-Core backend server URL. Data were then transferred directly from the Prediction App to CHAP Core over http://localhost:8000. This is obviously not a recommended solution in a production environment, since it will require the user to have CHAP Core running locally on their machine. Therefore, it makes sense to deploy CHAP to a server. To achieve this, we will deploy CHAP Core to the same server as a DHIS2 backend is running, ensuring that the CHAP Core REST-API is available internally to the DHIS2 backend. The Prediction App will then use the DHIS2 Route API to connect to the CHAP Core endpoint. We will explain the purpose of the Route API later.</p>
<p><strong>IMPORTANT:</strong> We do not want to make the CHAP Core endpoint publicly available on the internet, since CHAP Core does not have any way of authenticating requests.</p>
<section id="recommendation-around-containerization">
<h2>Recommendation around containerization<a class="headerlink" href="#recommendation-around-containerization" title="Link to this heading">¶</a></h2>
<p>We strongly recommend using CHAP Core with a container framework such as Docker, LXC, or Kubernetes, where CHAP Core runs in its own container. CHAP Core consists of several different services. In our <a class="reference external" href="https://github.com/dhis2-chap/chap-core">CHAP Core repo</a>, we provide a docker-compose file that containerizes each of these services and makes them work together. We highly recommend you use this docker-compose file when installing CHAP Core since installing each of these services could be difficult without Docker.</p>
</section>
<section id="lxc-container-setup">
<h2>LXC container setup<a class="headerlink" href="#lxc-container-setup" title="Link to this heading">¶</a></h2>
<p>To run CHAP Core on a server that is using LXC, you need to create a new LXC container dedicated to CHAP Core. Within this LXC container, you then need to install Docker. The CHAP Core team has an example of such a setup, which can be found at <a class="reference external" href="https://github.com/dhis2-chap/infrastructure">https://github.com/dhis2-chap/infrastructure</a>. Handle this code with care. The code is used to deploy CHAP Core on a server for conducting integration testing. We recommend everyone only uses this as an example and creates their own bash script for deploying CHAP Core within an LXC container.</p>
</section>
<section id="clone-the-chap-core-repo-into-your-lxc-container">
<h2>Clone the CHAP Core repo into your LXC container<a class="headerlink" href="#clone-the-chap-core-repo-into-your-lxc-container" title="Link to this heading">¶</a></h2>
<p>Within your LXC container dedicated to CHAP Core, you need to use git to clone the CHAP Core repo by using <strong>git clone https://github.com/dhis2-chap/chap-core.git</strong>. If you follow the <a class="reference external" href="https://github.com/dhis2-chap/infrastructure">infrastructure repo</a>, you can see that we fetch the CHAP Core repo and start CHAP Core immediately after the LXC container is created. If you do so, you will need to store your Google Earth Engine credentials outside the LXC container as environment variables. See these two lines, for how to insert environment variables into the LXC container.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">  </span>lxc<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>chap-core<span class="w"> </span>environment.GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY</span><span class="s2">&quot;</span>
<span class="w">  </span>lxc<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>chap-core<span class="w"> </span>environment.GOOGLE_SERVICE_ACCOUNT_EMAIL<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$GOOGLE_SERVICE_ACCOUNT_EMAIL</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>
<section id="add-google-earth-engine-credentials-directly-to-the-container">
<h2>Add Google Earth Engine credentials directly to the container<a class="headerlink" href="#add-google-earth-engine-credentials-directly-to-the-container" title="Link to this heading">¶</a></h2>
<p>If you have not stored the Google Earth Engine credentials outside the LXC container, you have the option to add them directly within the LXC container. This is not recommended since if your LXC container gets destroyed, you will need to manually add the credentials back again. Instead, we recommend you to have an “infrastructure as code” approach, where you, for instance, have a pipeline for deploying CHAP Core. If you do not have the pipeline yet and only want to test CHAP Core out, you have the option to add credentials directly in the LXC container. To achieve this, you could create a <strong>.env</strong> file in the root folder in the CHAP Core repo, where you insert the variables <strong>“GOOGLE_SERVICE_ACCOUNT_EMAIL”</strong> and <strong>“GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY”</strong>.</p>
<p>The <strong>.env</strong> file should look similar to the following content:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nv">GOOGLE_SERVICE_ACCOUNT_EMAIL</span><span class="o">=</span><span class="s2">&quot;your-google-service-account@company.iam.gserviceaccount.com&quot;</span>
<span class="w">  </span><span class="nv">GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY</span><span class="o">=</span><span class="s2">&quot;-----BEGIN PRIVATE KEY-----&lt;your-private-key&gt;-----END PRIVATE KEY-----&quot;</span>
</pre></div>
</div>
<p>The file should be stored at the same level where you find the Docker compose file, such as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">chap</span><span class="o">-</span><span class="n">core</span>
<span class="o">|--</span> <span class="n">compose</span><span class="o">.</span><span class="n">integration</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">yml</span>
<span class="o">|--</span> <span class="n">compose</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">yml</span>
<span class="o">|--</span> <span class="n">compose</span><span class="o">.</span><span class="n">yml</span>
<span class="o">|--</span> <span class="o">.</span><span class="n">env</span>
<span class="o">|--</span> <span class="n">chap_core</span><span class="o">/</span>
</pre></div>
</div>
<p><em>Not all files are included in this file-structure snippet</em></p>
<p><strong>NB!</strong> If you were already running CHAP Core when discovering that these variables were missing, you need to run <strong>docker compose down</strong> before starting CHAP Core with <strong>docker compose up</strong>. Warnings about missing environment variables should disappear.</p>
</section>
<section id="start-chap-core">
<h2>Start CHAP Core<a class="headerlink" href="#start-chap-core" title="Link to this heading">¶</a></h2>
<p>After you have cloned the CHAP Core repo, you start CHAP Core by running <strong>docker compose up</strong>. CHAP Core will then expose the REST Api at port 8000.</p>
</section>
<section id="identify-the-chap-core-server-ip-address-and-verify-chap-core-is-running-properly">
<h2>Identify the CHAP Core server IP address and verify CHAP Core is running properly<a class="headerlink" href="#identify-the-chap-core-server-ip-address-and-verify-chap-core-is-running-properly" title="Link to this heading">¶</a></h2>
<p>We now have CHAP Core running in Docker within an LXC container dedicated to CHAP Core. Next, you need to identify the IP address (for instance 192.168.0.174) of the LXC container running CHAP Core. This IP address is needed to get the DHIS2 Route API to work. Again, the IP address of CHAP Core should not be exposed publicly, only internally on the server. If you are running with LXC, you could, for instance, use <strong>lxc list</strong> to locate this IP address. You should then use the “curl” command to verify that you can connect to the LXC container. In the same terminal as you listed your containers, try to run <strong>curl http://[YOUR_IP_ADDRESS]:8000/docs</strong> (for instance curl http://192.168.0.174:8000/docs). If CHAP Core is running correctly, you should, in response, get some HTML swagger content. Next, verify if you can connect to CHAP Core from the container you are running DHIS2 by executing this container and using the curl command (for instance curl http://192.168.0.174:8000/docs).</p>
</section>
<section id="route-api">
<h2>Route API<a class="headerlink" href="#route-api" title="Link to this heading">¶</a></h2>
<p>The newer version of DHIS2 supports a built-in reverse proxy named <a class="reference external" href="https://docs.dhis2.org/en/develop/using-the-api/dhis-core-version-241/route.html">Routes API</a>. This means you could use the DHIS2 backend to forward a request (typically sent from a frontend application) to another IP address or URL (in our case the CHAP Core). To use the Route API (the reverse proxy), we need to configure a “route” in the DHIS2 backend that forwards requests sent from the Prediction App to the CHAP Core. First, we create a Route in DHIS2, which means a resource in DHIS2 that holds information about which URL/IP our “route” in DHIS2 should forward requests to. The Prediction App supports a user interface for creating the needed route, where you only need to specify which URL or IP the request should be forwarded to by the route. To create a new route, it requires you to have the DHIS2 System Administrator Role. The IP/URL you need to insert is the IP/URL (for instance http://192.168.0.174) you located (and verified that was accessible from the DHIS2 container) in the step above. Insert this IP/URL into the input field and click “Save”. Additionally, clear any value in the “Edit CHAP-Core URL” dialog (it should be empty when using the Route API), and click save.</p>
</section>
<section id="using-the-prediction-app">
<h2>Using The Prediction App<a class="headerlink" href="#using-the-prediction-app" title="Link to this heading">¶</a></h2>
<p>The Prediction App should now be able to use the “route” you created to connect to CHAP Core. You could now go to the “Route API settings” in the Prediction App and verify if the Prediction App can connect to CHAP Core. If not, check if the “route” values are correct and correspond with the IP/URL you used when you tried to connect to CHAP Core from the container you are running DHIS2 in.</p>
<p>Prediction App Video: <a class="reference external" href="https://youtu.be/6VYws5ywxtg">https://youtu.be/6VYws5ywxtg</a></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../tutorials/wrapping_gluonts.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Wrapping GluonTS models</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="docker-compose-doc.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">CHAP-Core docker compose setup</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; CHAP
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Running CHAP Core on a server with DHIS2 to be used with the Prediction App</a><ul>
<li><a class="reference internal" href="#recommendation-around-containerization">Recommendation around containerization</a></li>
<li><a class="reference internal" href="#lxc-container-setup">LXC container setup</a></li>
<li><a class="reference internal" href="#clone-the-chap-core-repo-into-your-lxc-container">Clone the CHAP Core repo into your LXC container</a></li>
<li><a class="reference internal" href="#add-google-earth-engine-credentials-directly-to-the-container">Add Google Earth Engine credentials directly to the container</a></li>
<li><a class="reference internal" href="#start-chap-core">Start CHAP Core</a></li>
<li><a class="reference internal" href="#identify-the-chap-core-server-ip-address-and-verify-chap-core-is-running-properly">Identify the CHAP Core server IP address and verify CHAP Core is running properly</a></li>
<li><a class="reference internal" href="#route-api">Route API</a></li>
<li><a class="reference internal" href="#using-the-prediction-app">Using The Prediction App</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=63b572e7"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>